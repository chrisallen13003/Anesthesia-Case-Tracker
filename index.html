<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SRNA Case Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: linear-gradient(to bottom, #e6f3fa, #f0f9fa);
    }
    .form-container {
      background: white;
      border-radius: 0.75rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .case-item:nth-child(even) {
      background: #f1f5f9;
    }
    .case-item:hover {
      background: #e2e8f0;
      transition: background 0.2s;
    }
    .btn-primary {
      background: #1d4ed8;
      transition: background 0.3s;
    }
    .btn-primary:hover {
      background: #1e40af;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: white;
      padding: 24px;
      border-radius: 0.5rem;
      max-width: 300px;
      width: 90%;
    }
    .modal-content p {
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }
    .modal-content .notes {
      border: 1px solid #4b5563;
      padding: 10px;
      border-radius: 0.25rem;
      background: #f8fafc;
    }
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      border-bottom: 2px solid transparent;
    }
    .tab.active {
      border-bottom: 2px solid #1d4ed8;
      font-weight: bold;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .highlight {
      background: #d1fae5;
      padding: 2px 6px;
      border-radius: 4px;
    }
    .placeholder {
      color: #9ca3af;
      font-style: italic;
    }
    .pearls-btn {
      color: #1d4ed8;
      cursor: pointer;
      text-decoration: underline;
    }
    .pearls-btn:hover {
      color: #1e40af;
    }
    .go-deeper {
      color: #1d4ed8;
      text-decoration: underline;
      cursor: pointer;
    }
    .go-deeper:hover {
      color: #1e40af;
    }
    .comparison-table th, .comparison-table td {
      border: 1px solid #e5e7eb;
      padding: 8px;
      text-align: left;
    }
    .comparison-table tr:nth-child(even) {
      background: #f8fafc;
    }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen">
  <div id="mainApp" class="w-full max-w-4xl p-6 form-container">
    <h1 class="text-3xl font-bold text-center text-teal-700 mb-8">SRNA Case Tracker</h1>
    <div id="privacyDisclaimer" class="mb-4 p-2 bg-blue-100 text-blue-800 rounded-md">Do not enter patient-identifiable information to comply with HIPAA.</div>
    <div class="flex border-b mb-4">
      <div class="tab active" data-tab="caseTracker">Case Tracker</div>
      <div class="tab" data-tab="drugList">Drug List</div>
      <div class="tab" data-tab="drugPearls">Drug Pearls</div>
      <div class="tab" data-tab="calculations">Calculations</div>
      <div class="tab" data-tab="keyPoints">Key Points</div>
    </div>
    <div id="caseTracker" class="tab-content active">
      <form id="caseForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label for="date" class="block text-sm font-medium text-teal-800">Date</label>
          <input type="date" id="date" name="date" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
        </div>
        <div>
          <label for="age" class="block text-sm font-medium text-teal-800">Age</label>
          <input type="number" id="age" name="age" min="0" max="120" placeholder="e.g., 45" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
        </div>
        <div>
          <label for="startTime" class="block text-sm font-medium text-teal-800">Start Time</label>
          <input type="time" id="startTime" name="startTime" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
        </div>
        <div>
          <label for="stopTime" class="block text-sm font-medium text-teal-800">Stop Time</label>
          <input type="time" id="stopTime" name="stopTime" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
        </div>
        <div class="md:col-span-2">
          <label for="caseName" class="block text-sm font-medium text-teal-800">Case Name</label>
          <input type="text" id="caseName" name="caseName" placeholder="e.g., Appendectomy - 3/1/25" required class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
        </div>
        <div>
          <label for="asaStatus" class="block text-sm font-medium text-teal-800">ASA Status</label>
          <select id="asaStatus" name="asaStatus" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
            <option value="" disabled selected>Select ASA Status</option>
            <option value="1">ASA 1</option>
            <option value="2">ASA 2</option>
            <option value="3">ASA 3</option>
            <option value="4">ASA 4</option>
            <option value="5">ASA 5</option>
            <option value="6">ASA 6</option>
            <option value="1E">ASA 1E</option>
            <option value="2E">ASA 2E</option>
            <option value="3E">ASA 3E</option>
            <option value="4E">ASA 4E</option>
            <option value="5E">ASA 5E</option>
            <option value="6E">ASA 6E</option>
          </select>
        </div>
        <div>
          <label for="caseType" class="block text-sm font-medium text-teal-800">Case Type</label>
          <input type="text" id="caseType" name="caseType" placeholder="e.g., General, OB, Neuro, Trauma" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
        </div>
        <div class="md:col-span-2">
          <label for="notes" class="block text-sm font-medium text-teal-800">Notes</label>
          <textarea id="notes" name="notes" rows="4" placeholder="e.g., Anesthesia Procedures (Art-line, CVC, POCUS), Anesthesia Type (General, Regional, MAC)" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500"></textarea>
        </div>
        <div class="md:col-span-2">
          <button type="submit" class="w-full btn-primary text-white p-3 rounded-md">Save Case</button>
        </div>
      </form>
      <div id="caseList" class="mt-8">
        <h2 class="text-xl font-semibold text-teal-700 mb-4">Saved Cases</h2>
        <ul id="cases" class="space-y-2"></ul>
      </div>
      <button id="clearCases" class="mt-4 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">Clear All Cases</button>
    </div>
    <div id="drugList" class="tab-content">
      <h2 class="text-xl font-semibold text-teal-700 mb-4">Anesthesia Drugs</h2>
      <div class="mb-4">
        <label for="ptWeight" class="block text-sm font-medium text-teal-800">Weight (kg)</label>
        <input type="number" id="ptWeight" min="0" placeholder="e.g., 70" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
      </div>
      <h3 class="text-lg font-medium text-teal-800 mb-2">Induction</h3>
      <ul class="space-y-2 mb-4">
        <li><strong>Propofol:</strong> 1.5-2.5 mg/kg IV <span id="propofolDose" class="highlight"></span> <span class="pearls-btn" data-drug="propofol">[Pearls]</span></li>
        <li><strong>Etomidate:</strong> 0.2-0.3 mg/kg IV <span id="etomidateDose" class="highlight"></span> <span class="pearls-btn" data-drug="etomidate">[Pearls]</span></li>
        <li><strong>Lidocaine:</strong> 1-1.5 mg/kg IV <span id="lidocaineInductionDose" class="highlight"></span> <span class="pearls-btn" data-drug="lidocaine">[Pearls]</span></li>
        <li><strong>Ketamine:</strong> 1-2 mg/kg IV <span id="ketamineDose" class="highlight"></span> <span class="pearls-btn" data-drug="ketamine">[Pearls]</span></li>
        <li><strong>Fentanyl:</strong> 1-2 mcg/kg IV <span id="fentanylInductionDose" class="highlight"></span> <span class="pearls-btn" data-drug="fentanyl">[Pearls]</span></li>
        <li><strong>Succinylcholine:</strong> 1-1.5 mg/kg IV <span id="succinylcholineDose" class="highlight"></span> <span class="pearls-btn" data-drug="succinylcholine">[Pearls]</span></li>
        <li><strong>Rocuronium:</strong> 0.6-1.2 mg/kg IV <span id="rocuroniumInductionDose" class="highlight"></span> <span class="pearls-btn" data-drug="rocuronium">[Pearls]</span></li>
      </ul>
      <h3 class="text-lg font-medium text-teal-800 mb-2">Sedation</h3>
      <ul class="space-y-2 mb-4">
        <li><strong>Midazolam:</strong> 0.02-0.04 mg/kg IV <span id="midazolamDose" class="highlight"></span> <span class="pearls-btn" data-drug="midazolam">[Pearls]</span></li>
        <li><strong>Precedex:</strong> Loading: 0.5-1 mcg/kg IV over 10 min; Maintenance: 0.2-0.7 mcg/kg/hr <span id="precedexDose" class="highlight"></span> <span class="pearls-btn" data-drug="precedex">[Pearls]</span></li>
      </ul>
      <h3 class="text-lg font-medium text-teal-800 mb-2">Reversal</h3>
      <ul class="space-y-2 mb-4">
        <li><strong>Naloxone:</strong> 0.04-0.4 mg IV <span id="naloxoneDose" class="highlight"></span> <span class="pearls-btn" data-drug="naloxone">[Pearls]</span></li>
        <li><strong>Neostigmine:</strong> 0.04-0.07 mg/kg IV (with Glycopyrrolate) <span id="neostigmineDose" class="highlight"></span> <span class="pearls-btn" data-drug="neostigmine">[Pearls]</span></li>
        <li><strong>Sugammadex:</strong> 2-4 mg/kg IV <span id="sugammadexDose" class="highlight"></span> <span class="pearls-btn" data-drug="sugammadex">[Pearls]</span></li>
      </ul>
      <h3 class="text-lg font-medium text-teal-800 mb-2">Vasoactive Uppers</h3>
      <ul class="space-y-2 mb-4">
        <li><strong>Glycopyrrolate:</strong> 0.2 mg per 1 mg Neostigmine IV <span id="glycopyrrolateDose" class="highlight"></span> <span class="pearls-btn" data-drug="glycopyrrolate">[Pearls]</span></li>
        <li><strong>Atropine:</strong> 0.01-0.02 mg/kg IV <span id="atropineDose" class="highlight"></span> <span class="pearls-btn" data-drug="atropine">[Pearls]</span></li>
        <li><strong>Phenylephrine:</strong> Bolus: 50-200 mcg IV; Infusion: 0.1-0.5 mcg/kg/min <span id="phenylephrineDose" class="highlight"></span> <span class="pearls-btn" data-drug="phenylephrine">[Pearls]</span></li>
        <li><strong>Ephedrine:</strong> 5-10 mg IV <span id="ephedrineDose" class="highlight"></span> <span class="pearls-btn" data-drug="ephedrine">[Pearls]</span></li>
        <li><strong>Norepinephrine:</strong> 0.01-0.1 mcg/kg/min <span id="norepinephrineDose" class="highlight"></span> <span class="pearls-btn" data-drug="norepinephrine">[Pearls]</span></li>
      </ul>
      <h3 class="text-lg font-medium text-teal-800 mb-2">Vasoactive Downers</h3>
      <ul class="space-y-2 mb-4">
        <li><strong>Esmolol:</strong> Bolus: 0.5 mg/kg IV; Infusion: 50-200 mcg/kg/min <span id="esmololDose" class="highlight"></span> <span class="pearls-btn" data-drug="esmolol">[Pearls]</span></li>
        <li><strong>Metoprolol:</strong> 1-5 mg IV <span id="metoprololDose" class="highlight"></span> <span class="pearls-btn" data-drug="metoprolol">[Pearls]</span></li>
        <li><strong>Hydralazine:</strong> 5-20 mg IV <span id="hydralazineDose" class="highlight"></span> <span class="pearls-btn" data-drug="hydralazine">[Pearls]</span></li>
        <li><strong>Nitroglycerin:</strong> 5-20 mcg/min <span id="nitroglycerinDose" class="highlight"></span> <span class="pearls-btn" data-drug="nitroglycerin">[Pearls]</span></li>
      </ul>
      <h3 class="text-lg font-medium text-teal-800 mb-2">Antiemetics</h3>
      <ul class="space-y-2">
        <li><strong>Dexamethasone:</strong> 4-8 mg IV <span id="decadronDose" class="highlight"></span> <span class="pearls-btn" data-drug="dexamethasone">[Pearls]</span></li>
        <li><strong>Ondansetron:</strong> 4-8 mg IV <span id="zofranDose" class="highlight"></span> <span class="pearls-btn" data-drug="ondansetron">[Pearls]</span></li>
        <li><strong>Haloperidol:</strong> 0.5-2 mg IV <span id="haldolDose" class="highlight"></span> <span class="pearls-btn" data-drug="haloperidol">[Pearls]</span></li>
      </ul>
      <p class="mt-4 text-sm text-gray-600">Note: Dosages are guidelines. Adjust for age, comorbidities, and protocols.</p>
    </div>
    <div id="drugPearls" class="tab-content">
      <h2 class="text-xl font-semibold text-teal-700 mb-4">Drug Pearls</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <div>
          <label for="drug1Search" class="block text-sm font-medium text-teal-800">Search Drug 1</label>
          <input type="text" id="drug1Search" list="drugList" placeholder="e.g., Propofol" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
        </div>
        <div>
          <label for="drug2Search" class="block text-sm font-medium text-teal-800">Search Drug 2 (Optional)</label>
          <input type="text" id="drug2Search" list="drugList" placeholder="e.g., Sugammadex" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
        </div>
        <datalist id="drugList">
          <option value="propofol">Propofol</option>
          <option value="etomidate">Etomidate</option>
          <option value="lidocaine">Lidocaine</option>
          <option value="ketamine">Ketamine</option>
          <option value="fentanyl">Fentanyl</option>
          <option value="succinylcholine">Succinylcholine</option>
          <option value="rocuronium">Rocuronium</option>
          <option value="midazolam">Midazolam</option>
          <option value="precedex">Precedex</option>
          <option value="naloxone">Naloxone</option>
          <option value="neostigmine">Neostigmine</option>
          <option value="sugammadex">Sugammadex</option>
          <option value="glycopyrrolate">Glycopyrrolate</option>
          <option value="atropine">Atropine</option>
          <option value="phenylephrine">Phenylephrine</option>
          <option value="ephedrine">Ephedrine</option>
          <option value="norepinephrine">Norepinephrine</option>
          <option value="esmolol">Esmolol</option>
          <option value="metoprolol">Metoprolol</option>
          <option value="hydralazine">Hydralazine</option>
          <option value="nitroglycerin">Nitroglycerin</option>
          <option value="dexamethasone">Dexamethasone</option>
          <option value="ondansetron">Ondansetron</option>
          <option value="haloperidol">Haloperidol</option>
        </datalist>
      </div>
      <button id="exportPearls" class="mb-4 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">Export Comparison as CSV</button>
      <div id="pearlsComparison" class="mt-4"></div>
    </div>
    <div id="calculations" class="tab-content">
      <h2 class="text-xl font-semibold text-teal-700 mb-4">Calculations</h2>
      <div class="mb-6 p-4 bg-gray-100 rounded-md">
        <h3 class="text-lg font-medium text-teal-800 mb-2">Patient Data</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label for="calcHeightUnit" class="block text-sm font-medium text-teal-800">Height Unit</label>
            <select id="calcHeightUnit" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
              <option value="cm">cm</option>
              <option value="in">inches</option>
              <option value="ftin">feet/inches</option>
            </select>
            <div id="heightCm" class="mt-2">
              <label for="calcHeightCm" class="block text-sm font-medium text-teal-800">Height (cm)</label>
              <input type="number" id="calcHeightCm" min="0" placeholder="e.g., 170" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
            </div>
            <div id="heightIn" class="mt-2 hidden">
              <label for="calcHeightIn" class="block text-sm font-medium text-teal-800">Height (inches)</label>
              <input type="number" id="calcHeightIn" min="0" placeholder="e.g., 67" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
            </div>
            <div id="heightFtIn" class="mt-2 hidden">
              <label for="calcHeightFt" class="block text-sm font-medium text-teal-800">Feet</label>
              <input type="number" id="calcHeightFt" min="0" placeholder="e.g., 5" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
              <label for="calcHeightInFt" class="block text-sm font-medium text-teal-800 mt-2">Inches</label>
              <input type="number" id="calcHeightInFt" min="0" max="11" placeholder="e.g., 11" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
            </div>
          </div>
          <div>
            <label for="calcWeightUnit" class="block text-sm font-medium text-teal-800">Weight Unit</label>
            <select id="calcWeightUnit" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
              <option value="kg">kg</option>
              <option value="lb">lb</option>
            </select>
            <div id="weightKg" class="mt-2">
              <label for="calcWeightKg" class="block text-sm font-medium text-teal-800">Weight (kg)</label>
              <input type="number" id="calcWeightKg" min="0" placeholder="e.g., 70" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
            </div>
            <div id="weightLb" class="mt-2 hidden">
              <label for="calcWeightLb" class="block text-sm font-medium text-teal-800">Weight (lb)</label>
              <input type="number" id="calcWeightLb" min="0" placeholder="e.g., 154" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
            </div>
          </div>
          <div>
            <label for="calcGender" class="block text-sm font-medium text-teal-800">Gender</label>
            <select id="calcGender" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
              <option value="male">Male</option>
              <option value="female">Female</option>
            </select>
          </div>
        </div>
        <div class="mt-2 text-teal-800">
          <p id="ebvResult" class="inline"><span class="placeholder">EBV: Enter weight and gender</span></p><br>
          <p id="ibwResult" class="inline"><span class="placeholder">IBW: Enter height and gender</span></p><br>
          <p id="airwayRecommendations">
            <span id="tvRecommendation" class="placeholder">Tidal Volume: Enter weight</span><br>
            <span id="ettRecommendation" class="placeholder">ETT Size: Enter weight and gender</span><br>
            <span id="lmaRecommendation" class="placeholder">LMA Size: Enter weight</span>
          </p>
        </div>
      </div>
      <div class="grid grid-cols-1 gap-4">
        <div>
          <h3 class="text-lg font-medium text-teal-800">Allowable Blood Loss</h3>
          <label for="ebv" class="block text-sm font-medium text-teal-800">EBV (mL)</label>
          <input type="number" id="ebv" min="0" placeholder="e.g., 5000" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
          <label for="initialHct" class="block text-sm font-medium text-teal-800 mt-2">Initial Hct (%)</label>
          <input type="number" id="initialHct" min="0" placeholder="e.g., 40" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
          <label for="targetHct" class="block text-sm font-medium text-teal-800 mt-2">Target Hct (%)</label>
          <input type="number" id="targetHct" min="0" placeholder="e.g., 30" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
          <p id="ablResult" class="mt-2 text-teal-800"><span class="placeholder">ABL: Enter EBV and Hct values</span></p>
        </div>
        <div>
          <h3 class="text-lg font-medium text-teal-800">Maximum Local Anesthetic</h3>
          <label for="weightLocal" class="block text-sm font-medium text-teal-800">Weight (kg)</label>
          <input type="number" id="weightLocal" min="0" placeholder="e.g., 70" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
          <label for="anesthetic" class="block text-sm font-medium text-teal-800 mt-2">Anesthetic</label>
          <select id="anesthetic" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
            <option value="" disabled selected>Select Anesthetic</option>
            <option value="lidocaine">Lidocaine</option>
            <option value="bupivacaine">Bupivacaine</option>
            <option value="ropivacaine">Ropivacaine</option>
            <option value="mepivacaine">Mepivacaine</option>
          </select>
          <label for="concentration" class="block text-sm font-medium text-teal-800 mt-2">Concentration (%)</label>
          <select id="concentration" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
            <option value="" disabled selected>Select Concentration</option>
          </select>
          <label for="epi" class="block text-sm font-medium text-teal-800 mt-2">Epinephrine?</label>
          <select id="epi" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
            <option value="no">No</option>
            <option value="yes">Yes</option>
          </select>
          <p id="localResult" class="mt-2 text-teal-800"><span class="placeholder">Max Volume: Enter all fields</span></p>
        </div>
        <div>
          <h3 class="text-lg font-medium text-teal-800">Fluid and NPO Deficit</h3>
          <label for="weightFluid" class="block text-sm font-medium text-teal-800">Weight (kg)</label>
          <input type="number" id="weightFluid" min="0" placeholder="e.g., 70" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
          <label for="npoHours" class="block text-sm font-medium text-teal-800 mt-2">NPO Hours</label>
          <input type="number" id="npoHours" min="0" placeholder="e.g., 8" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
          <p id="fluidNpoResult" class="mt-2 text-teal-800"><span class="placeholder">Fluid: Enter weight and NPO hours</span></p>
        </div>
      </div>
    </div>
    <div id="keyPoints" class="tab-content">
      <h2 class="text-xl font-semibold text-teal-700 mb-4">Key Points for CRNAs</h2>
      <h3 class="text-lg font-medium text-teal-800 mb-2">Anesthesia Mnemonics</h3>
      <ul class="space-y-2 mb-4">
        <li><strong>MS MAIDS (OR Setup Checklist):</strong>
          <ul class="ml-4 space-y-1">
            <li>Machine: Check anesthesia machine, vaporizers, circuit</li>
            <li>Suction: Ensure working suction catheter</li>
            <li>Monitors: Apply pulse oximeter, BP cuff, ECG</li>
            <li>Airway: Prepare laryngoscope, ETT, LMA</li>
            <li>IV: Confirm patent IV access</li>
            <li>Drugs: Verify emergency drugs (e.g., succinylcholine, epinephrine)</li>
            <li>Special: Check case-specific equipment (e.g., regional block kit)</li>
          </ul>
        </li>
        <li><strong>V3 STOP FAST (Pre-Induction/Induction Checklist):</strong>
          <ul class="ml-4 space-y-1">
            <li>Vein: Confirm IV patency</li>
            <li>Vapor: Set volatile agent (e.g., sevoflurane)</li>
            <li>Vitals: Ensure monitors are on (BP, pulse ox)</li>
            <li>Suction: Verify suction catheter ready</li>
            <li>Tube: Prepare ETT or LMA</li>
            <li>Oxygen: Pre-oxygenate patient</li>
            <li>Position: Position patient correctly</li>
            <li>Fast Asleep: Confirm adequate anesthesia depth</li>
            <li>Airway: Secure airway (intubation or LMA placement)</li>
            <li>Surgery: Confirm readiness for incision</li>
            <li>Temperature: Monitor and maintain warming</li>
          </ul>
        </li>
      </ul>
      <h3 class="text-lg font-medium text-teal-800 mb-2">LMA Size Chart</h3>
      <ul class="space-y-2 mb-4">
        <li>Size 1: &lt;5 kg (neonates), 1-1.5 mL cuff</li>
        <li>Size 2: 10-20 kg (children), 7-10 mL cuff</li>
        <li>Size 3: 30-50 kg (small adults), 15-20 mL cuff</li>
        <li>Size 4: 50-70 kg (adults), 20-30 mL cuff</li>
        <li>Size 5: &gt;70 kg (large adults), 30-40 mL cuff</li>
      </ul>
      <h3 class="text-lg font-medium text-teal-800 mb-2">ETT Size Chart</h3>
      <ul class="space-y-2 mb-4">
        <li>Neonates (0-1 mo): 3.0-3.5 mm</li>
        <li>Children: (Age/4) + 4 mm (uncuffed) or +3.5 mm (cuffed)</li>
        <li>Adults: 7.0-8.0 mm (female), 8.0-9.0 mm (male)</li>
        <li>Depth: 3 × ETT size at teeth (e.g., 7.5 mm ETT at 22.5 cm)</li>
      </ul>
      <h3 class="text-lg font-medium text-teal-800 mb-2">Pediatric Basics</h3>
      <ul class="space-y-2 mb-4">
        <li>Fluids: 4-2-1 rule (4 mL/kg/hr for first 10 kg, 2 mL/kg/hr for next 10 kg, 1 mL/kg/hr thereafter)</li>
        <li>Propofol: 2-3 mg/kg IV (induction)</li>
        <li>Epinephrine (PALS): 0.01 mg/kg IV/IO (1:10,000) for cardiac arrest</li>
      </ul>
      <h3 class="text-lg font-medium text-teal-800 mb-2">Crisis Management</h3>
      <ul class="space-y-2">
        <li>Malignant Hyperthermia: Dantrolene 2.5 mg/kg IV, call MH hotline</li>
        <li>Anaphylaxis: Epinephrine 10-20 mcg IV bolus</li>
        <li>MAC Awareness: Monitor end-tidal agent (e.g., Sevoflurane 2-3%)</li>
      </ul>
    </div>
    <div id="modal" class="modal">
      <div class="modal-content">
        <h3 class="text-lg font-semibold text-teal-700 mb-4" id="modalCaseName"></h3>
        <div id="modalContent"></div>
        <form id="editForm" class="hidden grid grid-cols-1 gap-4">
          <div>
            <label for="editCaseName" class="block text-sm font-medium text-teal-800">Case Name</label>
            <input type="text" id="editCaseName" name="caseName" placeholder="e.g., Appendectomy - 3/1/25" required class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
          </div>
          <div>
            <label for="editDate" class="block text-sm font-medium text-teal-800">Date</label>
            <input type="date" id="editDate" name="date" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
          </div>
          <div>
            <label for="editAge" class="block text-sm font-medium text-teal-800">Age</label>
            <input type="number" id="editAge" name="age" min="0" max="120" placeholder="e.g., 45" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
          </div>
          <div>
            <label for="editStartTime" class="block text-sm font-medium text-teal-800">Start Time</label>
            <input type="time" id="editStartTime" name="startTime" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
          </div>
          <div>
            <label for="editStopTime" class="block text-sm font-medium text-teal-800">Stop Time</label>
            <input type="time" id="editStopTime" name="stopTime" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
          </div>
          <div>
            <label for="editAsaStatus" class="block text-sm font-medium text-teal-800">ASA Status</label>
            <select id="editAsaStatus" name="asaStatus" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
              <option value="" disabled>Select ASA Status</option>
              <option value="1">ASA 1</option>
              <option value="2">ASA 2</option>
              <option value="3">ASA 3</option>
              <option value="4">ASA 4</option>
              <option value="5">ASA 5</option>
              <option value="6">ASA 6</option>
              <option value="1E">ASA 1E</option>
              <option value="2E">ASA 2E</option>
              <option value="3E">ASA 3E</option>
              <option value="4E">ASA 4E</option>
              <option value="5E">ASA 5E</option>
              <option value="6E">ASA 6E</option>
            </select>
          </div>
          <div>
            <label for="editCaseType" class="block text-sm font-medium text-teal-800">Case Type</label>
            <input type="text" id="editCaseType" name="caseType" placeholder="e.g., General, OB, Neuro, Trauma" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500">
          </div>
          <div>
            <label for="editNotes" class="block text-sm font-medium text-teal-800">Notes</label>
            <textarea id="editNotes" name="notes" rows="4" placeholder="e.g., Anesthesia Procedures (Art-line, CVC, POCUS), Anesthesia Type (General, Regional, MAC)" class="mt-1 block w-full p-2 border border-teal-300 rounded-md focus:ring-teal-500 focus:border-teal-500"></textarea>
          </div>
          <div class="flex justify-end space-x-2">
            <button id="saveEdit" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Save Changes</button>
            <button id="cancelEdit" class="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700">Cancel</button>
          </div>
        </form>
        <div id="modalButtons" class="mt-4 flex justify-end space-x-2">
          <button id="editCase" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Edit</button>
          <button id="exportCase" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">Export as CSV</button>
          <button id="deleteCase" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700">Delete</button>
          <button id="closeModal" class="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700">Close</button>
        </div>
      </div>
    </div>
  </div>
  <script>
    let cases = JSON.parse(localStorage.getItem('cases')) || [];
    let selectedCaseId = null;
    const modal = document.getElementById('modal');
    const modalCaseName = document.getElementById('modalCaseName');
    const modalContent = document.getElementById('modalContent');
    const editForm = document.getElementById('editForm');
    const modalButtons = document.getElementById('modalButtons');

    // Drug pearls data
    const drugPearls = {
      propofol: {
        pearl: "Risk of hypotension; mix with lidocaine to reduce injection pain.",
        onset: "15-30 seconds",
        duration: "3-10 minutes",
        excretion: "Hepatic",
        use: "Induction, short-term sedation",
        contraindications: "Egg/soy allergy, hypovolemia"
      },
      etomidate: {
        pearl: "Minimal CV depression; risk of adrenal suppression.",
        onset: "30-60 seconds",
        duration: "3-5 minutes",
        excretion: "Hepatic",
        use: "Induction in unstable patients",
        contraindications: "Adrenal insufficiency"
      },
      lidocaine: {
        pearl: "Reduces propofol pain; monitor for LAST.",
        onset: "1-2 minutes",
        duration: "10-20 minutes",
        excretion: "Hepatic",
        use: "Adjunct for induction, local anesthesia",
        contraindications: "Heart block, LAST history"
      },
      ketamine: {
        pearl: "Preserves respiratory drive; may increase BP/HR.",
        onset: "30-60 seconds",
        duration: "5-10 minutes",
        excretion: "Hepatic",
        use: "Induction in trauma, hypotension",
        contraindications: "Severe hypertension, psychosis"
      },
      fentanyl: {
        pearl: "Potent opioid; titrate to avoid respiratory depression.",
        onset: "1-2 minutes",
        duration: "30-60 minutes",
        excretion: "Hepatic",
        use: "Intraoperative analgesia",
        contraindications: "Respiratory depression"
      },
      succinylcholine: {
        pearl: "Rapid onset; risk of hyperkalemia in burns/trauma.",
        onset: "30-60 seconds",
        duration: "5-10 minutes",
        excretion: "Plasma",
        use: "Rapid sequence intubation",
        contraindications: "Hyperkalemia, MH history"
      },
      rocuronium: {
        pearl: "Reversible with sugammadex; non-depolarizing.",
        onset: "1-2 minutes",
        duration: "30-60 minutes",
        excretion: "Hepatic",
        use: "Intubation, muscle relaxation",
        contraindications: "None major"
      },
      midazolam: {
        pearl: "Anterograde amnesia; titrate slowly.",
        onset: "1-5 minutes",
        duration: "1-6 hours",
        excretion: "Hepatic",
        use: "Preoperative sedation",
        contraindications: "Acute glaucoma"
      },
      precedex: {
        pearl: "No respiratory depression; monitor for bradycardia.",
        onset: "5-10 minutes",
        duration: "1-2 hours",
        excretion: "Hepatic",
        use: "ICU/procedural sedation",
        contraindications: "Heart block, hypotension"
      },
      naloxone: {
        pearl: "Reverses opioids; may precipitate withdrawal.",
        onset: "1-2 minutes",
        duration: "30-60 minutes",
        excretion: "Hepatic",
        use: "Opioid overdose",
        contraindications: "Opioid dependency"
      },
      neostigmine: {
        pearl: "Use with glycopyrrolate to prevent bradycardia.",
        onset: "5-15 minutes",
        duration: "1-2 hours",
        excretion: "Renal",
        use: "Reversal of non-depolarizing blockers",
        contraindications: "Asthma, heart block"
      },
      sugammadex: {
        pearl: "Rapid reversal; monitor for hypersensitivity.",
        onset: "2-3 minutes",
        duration: "Sustained",
        excretion: "Renal",
        use: "Reversal of rocuronium/vecuronium",
        contraindications: "Hypersensitivity"
      },
      glycopyrrolate: {
        pearl: "Less CNS effects than atropine; use with neostigmine.",
        onset: "1-2 minutes",
        duration: "2-4 hours",
        excretion: "Renal",
        use: "Prevent bradycardia",
        contraindications: "Glaucoma, myasthenia gravis"
      },
      atropine: {
        pearl: "Effective for bradycardia; may cause delirium.",
        onset: "1-2 minutes",
        duration: "1-2 hours",
        excretion: "Hepatic",
        use: "Bradycardia, hypersalivation",
        contraindications: "Glaucoma"
      },
      phenylephrine: {
        pearl: "Alpha-agonist; may cause reflex bradycardia.",
        onset: "1-2 minutes",
        duration: "10-20 minutes",
        excretion: "Hepatic",
        use: "Hypotension",
        contraindications: "Severe hypertension"
      },
      ephedrine: {
        pearl: "Mixed alpha/beta agonist; increases HR/BP.",
        onset: "1-2 minutes",
        duration: "10-60 minutes",
        excretion: "Renal",
        use: "Hypotension",
        contraindications: "MAOI use"
      },
      norepinephrine: {
        pearl: "Potent vasopressor; monitor for ischemia.",
        onset: "Immediate",
        duration: "Short (infusion)",
        excretion: "Hepatic",
        use: "Septic shock, hypotension",
        contraindications: "Peripheral ischemia"
      },
      esmolol: {
        pearl: "Short-acting beta-blocker; ideal for acute tachycardia.",
        onset: "1-2 minutes",
        duration: "10-20 minutes",
        excretion: "Hepatic",
        use: "Intraoperative tachycardia",
        contraindications: "Asthma, heart block"
      },
      metoprolol: {
        pearl: "Longer-acting beta-blocker; use cautiously in asthma.",
        onset: "5-10 minutes",
        duration: "3-6 hours",
        excretion: "Hepatic",
        use: "Rate control, hypertension",
        contraindications: "Asthma, bradycardia"
      },
      hydralazine: {
        pearl: "Arterial vasodilator; may cause reflex tachycardia.",
        onset: "10-20 minutes",
        duration: "2-6 hours",
        excretion: "Hepatic",
        use: "Hypertension",
        contraindications: "Coronary artery disease"
      },
      nitroglycerin: {
        pearl: "Venodilator; monitor for hypotension.",
        onset: "1-3 minutes",
        duration: "30-60 minutes",
        excretion: "Hepatic",
        use: "Angina, heart failure",
        contraindications: "Hypotension, PDE-5 inhibitors"
      },
      dexamethasone: {
        pearl: "Reduces PONV; may increase blood glucose.",
        onset: "1-2 hours",
        duration: "24-72 hours",
        excretion: "Hepatic",
        use: "PONV prophylaxis",
        contraindications: "Uncontrolled diabetes"
      },
      ondansetron: {
        pearl: "Effective for PONV; may prolong QT interval.",
        onset: "15-30 minutes",
        duration: "4-8 hours",
        excretion: "Hepatic",
        use: "PONV treatment",
        contraindications: "Long QT syndrome"
      },
      haloperidol: {
        pearl: "For refractory nausea; monitor for EPS.",
        onset: "10-20 minutes",
        duration: "12-24 hours",
        excretion: "Hepatic",
        use: "Refractory PONV, agitation",
        contraindications: "Parkinson’s, EPS history"
      }
    };

    // Tab navigation
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.tab).classList.add('active');
      });
    });

    // Display saved cases
    function displayCases() {
      const caseList = document.getElementById('cases');
      caseList.innerHTML = '';
      cases.forEach((c, index) => {
        const li = document.createElement('li');
        li.className = 'p-3 case-item border border-teal-200 rounded-md cursor-pointer';
        li.innerHTML = `
          <strong>Case:</strong> ${c.caseName}<br>
          <strong>Date:</strong> ${c.date || 'Not Provided'}<br>
          <strong>Start/Stop:</strong> ${c.startTime || 'Not Provided'} - ${c.stopTime || 'Not Provided'}<br>
          <strong>Age:</strong> ${c.age || 'Not Provided'}<br>
          <strong>ASA:</strong> ${c.asaStatus || 'Not Provided'}<br>
          <strong>Type:</strong> ${c.caseType || 'Not Provided'}<br>
          <strong>Notes:</strong> ${c.notes ? `<div class="notes mt-2">${c.notes}</div>` : 'None'}
        `;
        li.addEventListener('click', () => showModal(c, index));
        caseList.appendChild(li);
      });
      caseList.classList.toggle('hidden', cases.length === 0);
    }

    // Show modal for case details
    function showModal(caseData, index) {
      selectedCaseId = index;
      modalCaseName.textContent = caseData.caseName;
      modalContent.innerHTML = `
        <p><strong>Date:</strong> ${caseData.date || 'Not Provided'}</p>
        <p><strong>Age:</strong> ${caseData.age || 'Not Provided'}</p>
        <p><strong>Start/Stop:</strong> ${caseData.startTime || 'Not Provided'} - ${caseData.stopTime || 'Not Provided'}</p>
        <p><strong>ASA Status:</strong> ${caseData.asaStatus || 'Not Provided'}</p>
        <p><strong>Case Type:</strong> ${caseData.caseType || 'Not Provided'}</p>
        <p><strong>Notes:</strong></p>
        <div class="notes">${caseData.notes || 'None'}</div>
      `;
      modalButtons.classList.remove('hidden');
      editForm.classList.add('hidden');
      modal.style.display = 'flex';
    }

    // Show modal for drug pearls
    function showDrugModal(drug) {
      const data = drugPearls[drug];
      if (data) {
        modalCaseName.textContent = drug.charAt(0).toUpperCase() + drug.slice(1);
        modalContent.innerHTML = `
          <p><strong>Pearl:</strong> ${data.pearl}</p>
          <p><strong>Onset:</strong> ${data.onset}</p>
          <p><strong>Duration:</strong> ${data.duration}</p>
          <p><strong>Excretion:</strong> ${data.excretion}</p>
          <p><strong>Contraindications:</strong> ${data.contraindications}</p>
          <p><span class="go-deeper" data-drug="${drug}">Go Deeper</span></p>
        `;
        modalButtons.classList.add('hidden');
        editForm.classList.add('hidden');
        modal.style.display = 'flex';
      }
    }

    // Handle pearls button clicks
    document.querySelectorAll('.pearls-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        showDrugModal(btn.dataset.drug);
      });
    });

    // Handle "Go Deeper" link
    modal.addEventListener('click', (e) => {
      if (e.target.classList.contains('go-deeper')) {
        const drug = e.target.dataset.drug;
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelector('.tab[data-tab="drugPearls"]').classList.add('active');
        document.getElementById('drugPearls').classList.add('active');
        document.getElementById('drug1Search').value = drug;
        updatePearlsComparison();
        modal.style.display = 'none';
      }
    });

    // Update pearls comparison table
    function updatePearlsComparison() {
      const drug1 = document.getElementById('drug1Search').value.toLowerCase();
      const drug2 = document.getElementById('drug2Search').value.toLowerCase();
      const pearlsComparison = document.getElementById('pearlsComparison');
      pearlsComparison.innerHTML = '';
      if (!drug1 || !drugPearls[drug1]) return;

      const headers = ['Property', drug1.charAt(0).toUpperCase() + drug1.slice(1)];
      const rows = [
        ['Pearl', drugPearls[drug1].pearl],
        ['Onset', drugPearls[drug1].onset],
        ['Duration', drugPearls[drug1].duration],
        ['Excretion', drugPearls[drug1].excretion],
        ['Use', drugPearls[drug1].use],
        ['Contraindications', drugPearls[drug1].contraindications]
      ];

      if (drug2 && drugPearls[drug2]) {
        headers.push(drug2.charAt(0).toUpperCase() + drug2.slice(1));
        rows[0].push(drugPearls[drug2].pearl);
        rows[1].push(drugPearls[drug2].onset);
        rows[2].push(drugPearls[drug2].duration);
        rows[3].push(drugPearls[drug2].excretion);
        rows[4].push(drugPearls[drug2].use);
        rows[5].push(drugPearls[drug2].contraindications);
      }

      const table = document.createElement('table');
      table.className = 'comparison-table w-full';
      const thead = document.createElement('thead');
      const headerRow = document.createElement('tr');
      headers.forEach(header => {
        const th = document.createElement('th');
        th.textContent = header;
        headerRow.appendChild(th);
      });
      thead.appendChild(headerRow);
      table.appendChild(thead);

      const tbody = document.createElement('tbody');
      rows.forEach(row => {
        const tr = document.createElement('tr');
        row.forEach(cell => {
          const td = document.createElement('td');
          td.textContent = cell;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
      table.appendChild(tbody);
      pearlsComparison.appendChild(table);
    }

    // Export pearls comparison as CSV
    document.getElementById('exportPearls').addEventListener('click', () => {
      const drug1 = document.getElementById('drug1Search').value.toLowerCase();
      const drug2 = document.getElementById('drug2Search').value.toLowerCase();
      if (!drug1 || !drugPearls[drug1]) {
        alert('Please select at least one drug.');
        return;
      }

      const headers = ['Property', drug1.charAt(0).toUpperCase() + drug1.slice(1)];
      const rows = [
        ['Pearl', drugPearls[drug1].pearl],
        ['Onset', drugPearls[drug1].onset],
        ['Duration', drugPearls[drug1].duration],
        ['Excretion', drugPearls[drug1].excretion],
        ['Use', drugPearls[drug1].use],
        ['Contraindications', drugPearls[drug1].contraindications]
      ];

      if (drug2 && drugPearls[drug2]) {
        headers.push(drug2.charAt(0).toUpperCase() + drug2.slice(1));
        rows[0].push(drugPearls[drug2].pearl);
        rows[1].push(drugPearls[drug2].onset);
        rows[2].push(drugPearls[drug2].duration);
        rows[3].push(drugPearls[drug2].excretion);
        rows[4].push(drugPearls[drug2].use);
        rows[5].push(drugPearls[drug2].contraindications);
      }

      const csv = [headers, ...rows].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `drug_comparison_${drug1}${drug2 ? '_' + drug2 : ''}.csv`;
      a.click();
      URL.revokeObjectURL(url);
    });

    // Update pearls comparison on search input
    document.getElementById('drug1Search').addEventListener('input', updatePearlsComparison);
    document.getElementById('drug2Search').addEventListener('input', updatePearlsComparison);

    // Handle case form submission
    document.getElementById('caseForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const newCase = {
        caseName: document.getElementById('caseName').value.trim(),
        date: document.getElementById('date').value,
        age: document.getElementById('age').value,
        startTime: document.getElementById('startTime').value,
        stopTime: document.getElementById('stopTime').value,
        asaStatus: document.getElementById('asaStatus').value,
        caseType: document.getElementById('caseType').value,
        notes: document.getElementById('notes').value,
        createdAt: new Date().toISOString()
      };
      cases.push(newCase);
      localStorage.setItem('cases', JSON.stringify(cases));
      displayCases();
      document.getElementById('caseForm').reset();
    });

    // Populate edit form
    document.getElementById('editCase').addEventListener('click', () => {
      const caseData = cases[selectedCaseId];
      if (caseData) {
        document.getElementById('editCaseName').value = caseData.caseName;
        document.getElementById('editDate').value = caseData.date || '';
        document.getElementById('editAge').value = caseData.age || '';
        document.getElementById('editStartTime').value = caseData.startTime || '';
        document.getElementById('editStopTime').value = caseData.stopTime || '';
        document.getElementById('editAsaStatus').value = caseData.asaStatus || '';
        document.getElementById('editCaseType').value = caseData.caseType || '';
        document.getElementById('editNotes').value = caseData.notes || '';
        modalContent.classList.add('hidden');
        modalButtons.classList.add('hidden');
        editForm.classList.remove('hidden');
      }
    });

    // Save edited case
    document.getElementById('saveEdit').addEventListener('click', (e) => {
      e.preventDefault();
      const updatedCase = {
        caseName: document.getElementById('editCaseName').value.trim(),
        date: document.getElementById('editDate').value,
        age: document.getElementById('editAge').value,
        startTime: document.getElementById('editStartTime').value,
        stopTime: document.getElementById('editStopTime').value,
        asaStatus: document.getElementById('editAsaStatus').value,
        caseType: document.getElementById('editCaseType').value,
        notes: document.getElementById('editNotes').value,
        createdAt: cases[selectedCaseId].createdAt
      };
      cases[selectedCaseId] = updatedCase;
      localStorage.setItem('cases', JSON.stringify(cases));
      displayCases();
      modal.style.display = 'none';
      modalContent.classList.remove('hidden');
    });

    // Cancel edit
    document.getElementById('cancelEdit').addEventListener('click', () => {
      modalContent.classList.remove('hidden');
      modalButtons.classList.remove('hidden');
      editForm.classList.add('hidden');
    });

    // Export case as CSV
    document.getElementById('exportCase').addEventListener('click', () => {
      const caseData = cases[selectedCaseId];
      if (caseData) {
        const csv = [
          ['Case Name', 'Date', 'Age', 'Start Time', 'Stop Time', 'ASA Status', 'Case Type', 'Notes'],
          [
            caseData.caseName,
            caseData.date || 'Not Provided',
            caseData.age || 'Not Provided',
            caseData.startTime || 'Not Provided',
            caseData.stopTime || 'Not Provided',
            caseData.asaStatus || 'Not Provided',
            caseData.caseType || 'Not Provided',
            caseData.notes || 'None'
          ]
        ].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${caseData.caseName}.csv`;
        a.click();
        URL.revokeObjectURL(url);
      }
    });

    // Delete case
    document.getElementById('deleteCase').addEventListener('click', () => {
      if (confirm('Are you sure you want to delete this case?')) {
        cases.splice(selectedCaseId, 1);
        localStorage.setItem('cases', JSON.stringify(cases));
        displayCases();
        modal.style.display = 'none';
      }
    });

    // Close modal
    document.getElementById('closeModal').addEventListener('click', () => {
      modal.style.display = 'none';
    });
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.style.display = 'none';
      }
    });

    // Clear all cases
    document.getElementById('clearCases').addEventListener('click', () => {
      if (confirm('Are you sure you want to clear all cases?')) {
        cases = [];
        localStorage.setItem('cases', JSON.stringify(cases));
        displayCases();
      }
    });

    // Calculate drug doses
    document.getElementById('ptWeight').addEventListener('input', () => {
      const weight = parseFloat(document.getElementById('ptWeight').value);
      if (!weight) {
        document.querySelectorAll('.highlight').forEach(span => span.textContent = '');
        return;
      }
      document.getElementById('propofolDose').textContent = `${(1.5 * weight).toFixed(1)}-${(2.5 * weight).toFixed(1)} mg`;
      document.getElementById('etomidateDose').textContent = `${(0.2 * weight).toFixed(1)}-${(0.3 * weight).toFixed(1)} mg`;
      document.getElementById('lidocaineInductionDose').textContent = `${(1 * weight).toFixed(1)}-${(1.5 * weight).toFixed(1)} mg`;
      document.getElementById('ketamineDose').textContent = `${(1 * weight).toFixed(1)}-${(2 * weight).toFixed(1)} mg`;
      document.getElementById('fentanylInductionDose').textContent = `${(1 * weight).toFixed(1)}-${(2 * weight).toFixed(1)} mcg`;
      document.getElementById('succinylcholineDose').textContent = `${(1 * weight).toFixed(1)}-${(1.5 * weight).toFixed(1)} mg`;
      document.getElementById('rocuroniumInductionDose').textContent = `${(0.6 * weight).toFixed(1)}-${(1.2 * weight).toFixed(1)} mg`;
      document.getElementById('midazolamDose').textContent = `${(0.02 * weight).toFixed(1)}-${(0.04 * weight).toFixed(1)} mg`;
      document.getElementById('precedexDose').textContent = `Load: ${(0.5 * weight).toFixed(1)}-${(1 * weight).toFixed(1)} mcg; Maint: ${(0.2 * weight).toFixed(1)}-${(0.7 * weight).toFixed(1)} mcg/hr`;
      document.getElementById('naloxoneDose').textContent = `0.04-0.4 mg`;
      document.getElementById('neostigmineDose').textContent = `${(0.04 * weight).toFixed(1)}-${(0.07 * weight).toFixed(1)} mg`;
      document.getElementById('sugammadexDose').textContent = `${(2 * weight).toFixed(1)}-${(4 * weight).toFixed(1)} mg`;
      document.getElementById('glycopyrrolateDose').textContent = `0.2 mg per 1 mg neostigmine`;
      document.getElementById('atropineDose').textContent = `${(0.01 * weight).toFixed(1)}-${(0.02 * weight).toFixed(1)} mg`;
      document.getElementById('phenylephrineDose').textContent = `Bolus: 50-200 mcg; Inf: ${(0.1 * weight).toFixed(1)}-${(0.5 * weight).toFixed(1)} mcg/min`;
      document.getElementById('ephedrineDose').textContent = `5-10 mg`;
      document.getElementById('norepinephrineDose').textContent = `${(0.01 * weight).toFixed(2)}-${(0.1 * weight).toFixed(2)} mcg/min`;
      document.getElementById('esmololDose').textContent = `Bolus: ${(0.5 * weight).toFixed(1)} mg; Inf: ${(50 * weight).toFixed(0)}-${(200 * weight).toFixed(0)} mcg/min`;
      document.getElementById('metoprololDose').textContent = `1-5 mg`;
      document.getElementById('hydralazineDose').textContent = `5-20 mg`;
      document.getElementById('nitroglycerinDose').textContent = `5-20 mcg/min`;
      document.getElementById('decadronDose').textContent = `4-8 mg`;
      document.getElementById('zofranDose').textContent = `4-8 mg`;
      document.getElementById('haldolDose').textContent = `0.5-2 mg`;
    });

    // Calculations
    const calcHeightUnit = document.getElementById('calcHeightUnit');
    const heightCm = document.getElementById('heightCm');
    const heightIn = document.getElementById('heightIn');
    const heightFtIn = document.getElementById('heightFtIn');
    const calcWeightUnit = document.getElementById('calcWeightUnit');
    const weightKg = document.getElementById('weightKg');
    const weightLb = document.getElementById('weightLb');
    const calcGender = document.getElementById('calcGender');
    const ebvResult = document.getElementById('ebvResult');
    const ibwResult = document.getElementById('ibwResult');
    const tvRecommendation = document.getElementById('tvRecommendation');
    const ettRecommendation = document.getElementById('ettRecommendation');
    const lmaRecommendation = document.getElementById('lmaRecommendation');
    const ebvInput = document.getElementById('ebv');
    const initialHct = document.getElementById('initialHct');
    const targetHct = document.getElementById('targetHct');
    const ablResult = document.getElementById('ablResult');
    const weightLocal = document.getElementById('weightLocal');
    const anesthetic = document.getElementById('anesthetic');
    const concentration = document.getElementById('concentration');
    const epi = document.getElementById('epi');
    const localResult = document.getElement
